openapi: 3.0.3
info:
  version: v1.0
  title: Freeday API
paths:
  /api/auth:
    get:
      tags:
        - Authentication
      summary: Gets current authentication information
      description: ''
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Authentication'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
    post:
      tags:
        - Authentication
      summary: Authenticates user with username and password
      description: ''
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthenticationPost'
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Authentication'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
    delete:
      tags:
        - Authentication
      summary: Revokes current authentication token
      description: ''
      responses:
        '200':
          content:
            application/json:
              schema:
                type: object
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/auth/welcome:
    get:
      tags:
        - Authentication
      summary: Checks the validity of a welcome secret code
      description: Welcome secret code must be provided in the Authorization header
      responses:
        '200':
          content:
            application/json:
              schema:
                type: object
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
    post:
      tags:
        - Authentication
      summary: Creates the first user using the welcome secret code
      description: Welcome secret code must be provided in the Authorization header
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthenticationWelcome'
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
    put:
      tags:
        - Authentication
      summary: >-
        Deletes self user and all tokens then generates initialization/welcome
        data and return secret code
      description: |
        * This endpoint is available only in test mode
        * It can be used to test the welcome course
        * Self user must be the only one in database
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthenticationSecret'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/users:
    get:
      tags:
        - Users
      summary: Gets the list of users
      description: ''
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserList'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
    post:
      tags:
        - Users
      summary: Creates a new user
      description: ''
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '409':
          $ref: '#/components/responses/ConflictError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/users/{userId}:
    get:
      tags:
        - Users
      summary: Gets user information
      description: ''
      parameters:
        - name: userId
          required: true
          in: path
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternError'
    post:
      tags:
        - Users
      summary: Edits a new user
      description: ''
      parameters:
        - name: userId
          required: true
          in: path
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserEdit'
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '409':
          $ref: '#/components/responses/ConflictError'
        '500':
          $ref: '#/components/responses/InternError'
    delete:
      tags:
        - Users
      summary: Deletes a user
      description: ''
      parameters:
        - name: userId
          required: true
          in: path
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                type: object
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/slack/auth:
    get:
      tags:
        - Slack
      summary: Gets Slack OAuth URL
      description: ''
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SlackOAuthUrl'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
    post:
      tags:
        - Slack
      summary: Registers Slack app with OAuth data returned by Slack
      description: ''
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SlackOAuthRegister'
      responses:
        '200':
          content:
            application/json:
              schema:
                type: object
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/slack/users:
    get:
      tags:
        - Slack
      summary: Gets the list Slack users
      description: >
        * Calling this method updates the Slack user list in database by
        synchronizing with Slack API (max. one time per minute)
      parameters:
        - name: deleted
          in: query
          schema:
            type: boolean
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SlackUserList'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
    post:
      tags:
        - Slack
      summary: Creates Slack user in database or updates if exists
      description: |
        * This endpoint is available only in test mode
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SlackUserCreate'
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SlackUser'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/slack/users/{slackUserId}:
    get:
      tags:
        - Slack
      summary: Gets Slack user information
      description: ''
      parameters:
        - name: slackUserId
          required: true
          in: path
          schema:
            type: string
            format: slack-id
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SlackUser'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/slack/channels:
    get:
      tags:
        - Slack
      summary: Gets the list Slack channels
      description: >
        * Calling this method updates the Slack channel list in database by
        synchronizing with Slack API (max. one time per minute)
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SlackChannelList'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
    post:
      tags:
        - Slack
      summary: Creates Slack channel in database or updates if exists
      description: |
        * This endpoint is available only in test mode
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SlackChannelCreate'
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SlackChannel'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/slack/channels/{slackChannelId}:
    get:
      tags:
        - Slack
      summary: Gets Slack channel information
      description: ''
      parameters:
        - name: slackChannelId
          required: true
          in: path
          schema:
            type: string
            format: slack-id
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SlackChannel'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/slack/events:
    post:
      tags:
        - Slack
      summary: Slack events endpoint
      description: Reserved for Slack events and interactivity
  /api/daysoff:
    get:
      tags:
        - Daysoff
      summary: Gets the list of days-off
      description: ''
      parameters:
        - name: start
          in: query
          schema:
            type: string
            format: date
        - name: end
          in: query
          schema:
            type: string
            format: date
        - name: type
          in: query
          style: form
          explode: false
          schema:
            type: array
            items:
              type: string
              format: uuid
        - name: slackUser
          in: query
          style: form
          explode: false
          schema:
            type: array
            items:
              type: string
              format: slack-id
        - name: status
          in: query
          schema:
            type: string
            enum:
              - confirmed
              - canceled
              - pending
        - name: order
          in: query
          schema:
            type: string
            format: slack-id
            enum:
              - asc
              - desc
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DayoffList'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
    post:
      tags:
        - Daysoff
      summary: Creates a new dayoff
      description: |
        * If conflicts with other daysoff are detected an error is thrown
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DayoffCreate'
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dayoff'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '409':
          $ref: '#/components/responses/ConflictError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/daysoff/{dayoffId}:
    get:
      tags:
        - Daysoff
      summary: Gets a dayoff
      description: ''
      parameters:
        - name: dayoffId
          required: true
          in: path
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dayoff'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternError'
    post:
      tags:
        - Daysoff
      summary: Edits a dayoff
      description: |
        * Dayoff status is reset back to 'pending' any time dayoff is edited
        * If conflicts with other daysoff are detected an error is thrown
      parameters:
        - name: dayoffId
          required: true
          in: path
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DayoffEdit'
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dayoff'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '409':
          $ref: '#/components/responses/ConflictError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/daysoff/{dayoffId}/conflicts:
    get:
      tags:
        - Daysoff
      summary: Gets the conflits of a dayoff
      description: ''
      parameters:
        - name: dayoffId
          required: true
          in: path
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                type: object
                properties:
                  conflicts:
                    type: array
                    items:
                      $ref: '#/components/schemas/Dayoff'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/daysoff/{dayoffId}/confirm:
    put:
      tags:
        - Daysoff
      summary: Sets dayoff status as confirmed
      description: ''
      parameters:
        - name: dayoffId
          required: true
          in: path
          schema:
            type: string
            format: uuid
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DayoffConfirmPost'
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dayoff'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '409':
          $ref: '#/components/responses/ConflictError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/daysoff/{dayoffId}/cancel:
    put:
      tags:
        - Daysoff
      summary: Sets dayoff status as canceled
      description: ''
      parameters:
        - name: dayoffId
          required: true
          in: path
          schema:
            type: string
            format: uuid
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DayoffCancelPost'
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dayoff'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/daysoff/{dayoffId}/reset:
    put:
      tags:
        - Daysoff
      summary: Resets dayoff status
      description: ''
      parameters:
        - name: dayoffId
          required: true
          in: path
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dayoff'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/daysoff/types:
    get:
      tags:
        - Dayoff types
      summary: Gets the list of day-off types
      description: ''
      parameters:
        - name: enabled
          in: query
          schema:
            type: boolean
        - name: displayed
          in: query
          schema:
            type: boolean
        - name: important
          in: query
          schema:
            type: boolean
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DayoffTypeList'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
    post:
      tags:
        - Dayoff types
      summary: Creates a new dayoff type
      description: >
        * If a dayoff type with same name already exist conflict error will be
        thrown
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DayoffTypeCreate'
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DayoffType'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '409':
          $ref: '#/components/responses/ConflictError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/daysoff/types/{dayoffTypeId}:
    get:
      tags:
        - Dayoff types
      summary: Get a dayoff type
      description: ''
      parameters:
        - name: dayoffTypeId
          required: true
          in: path
          schema:
            type: string
            format: uuid
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DayoffType'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternError'
    post:
      tags:
        - Dayoff types
      summary: Edit a dayoff type
      description: >
        * If a dayoff type with same name already exist conflict error will be
        thrown

        * When a dayoff type is modified all dayoff type data within daysoff are
        also updated
      parameters:
        - name: dayoffTypeId
          required: true
          in: path
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DayoffTypeData'
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DayoffType'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '409':
          $ref: '#/components/responses/ConflictError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/configuration:
    get:
      tags:
        - Configuration
      summary: Gets current configuration
      description: ''
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Configuration'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
    post:
      tags:
        - Configuration
      summary: Edit configuration
      description: ''
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfigurationPost'
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Configuration'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/configuration/public:
    get:
      tags:
        - Configuration
      summary: Gets current public configuration
      description: >-
        Public configuration is exposed for non-authenticated users in order to
        obtain basic information about the instance
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfigurationPublic'
        '500':
          $ref: '#/components/responses/InternError'
  /api/jobs/{jobName}:
    get:
      tags:
        - Jobs
      summary: Gets a job's settings
      description: ''
      parameters:
        - name: jobName
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Job'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternError'
    post:
      tags:
        - Jobs
      summary: Edit a jobs settings
      description: ''
      parameters:
        - name: jobName
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JobEdit'
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Job'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternError'
  /api/ping:
    get:
      tags:
        - Misc
      summary: Pings the API and returns public informations
      description: ''
      security: []
      responses:
        '200':
          content:
            application/json:
              schema:
                type: object
                properties:
                  version:
                    type: string
                    description: App version vX.X.X
                example:
                  version: v1.2.3
        '500':
          $ref: '#/components/responses/InternError'
components:
  securitySchemes:
    BearerToken:
      type: http
      scheme: bearer
      description: Authentication bearer token
  schemas:
    Authentication:
      type: object
      properties:
        userId:
          type: string
          format: uuid
          description: User ID
        limit:
          type: string
          format: date-time
          description: Token limit date of validity
        token:
          type: string
          description: Authentication token
      example:
        userId: 5c37cf93b24a96f47a29bec
        limit: '2018-09-28T15:35:49.828Z'
        token: Ep2uHmVctSupD5z2yCXa
    Error:
      type: object
      properties:
        error:
          type: string
          description: Error message
        code:
          type: integer
          description: Internal error code
        data:
          type: array
          description: Error data
          items:
            type: object
    AuthenticationPost:
      type: object
      properties:
        username:
          type: string
          description: User name
        password:
          type: string
          description: User password
      example:
        username: lucie.bronze
        password: password123
    AuthenticationSecret:
      type: object
      properties:
        secret:
          type: string
          description: Welcome secret code
          example: ajdVTPRWQwY3S0RUNX3SDtWcRwWbZUMGbm9NQWlF0Jg
    UserData:
      type: object
      properties:
        username:
          type: string
          description: User name
          minLength: 6
          example: lucie.bronze
        language:
          type: string
          format: country-code
          description: User language
          example: en
        theme:
          type: string
          enum:
            - light
            - dark
          description: User theme
          example: dark
    UserPassword:
      type: object
      properties:
        password:
          type: string
          description: User password
          minLength: 6
          default: en
          example: password123
    AuthenticationWelcome:
      allOf:
        - $ref: '#/components/schemas/UserData'
        - $ref: '#/components/schemas/UserPassword'
        - required:
            - username
            - password
    DocumentId:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 5c37cf93b24a96f47a29bec
    User:
      allOf:
        - $ref: '#/components/schemas/DocumentId'
        - $ref: '#/components/schemas/UserData'
    Total:
      type: object
      properties:
        total:
          type: integer
          description: Number of documents
          example: 1
    Page:
      type: object
      properties:
        current:
          type: integer
          description: Current page
          example: 1
        total:
          type: integer
          description: Total number of pages
          example: 1
    UserList:
      allOf:
        - type: object
          properties:
            users:
              type: array
              items:
                $ref: '#/components/schemas/User'
        - $ref: '#/components/schemas/Total'
        - $ref: '#/components/schemas/Page'
    UserCreate:
      allOf:
        - $ref: '#/components/schemas/UserData'
        - $ref: '#/components/schemas/UserPassword'
        - required:
            - username
            - password
    UserEdit:
      allOf:
        - $ref: '#/components/schemas/UserData'
        - $ref: '#/components/schemas/UserPassword'
    SlackOAuthUrl:
      type: object
      properties:
        url:
          type: string
          format: uri
          description: Slack OAuth URL
          example: >-
            https://slack.com/oauth/v2/authorize?client_id=1234&scope=some:scope&redirect_uri=some.url&state=1234
    SlackOAuthRegister:
      type: object
      properties:
        code:
          type: string
          description: Slack OAuth verification code
          example: '516549849849.65498498469498498'
        state:
          type: string
          description: Slack OAuth state needed to authenticate OAuth data
          example: 91d516f51b519a546d5654a6f4b654
      required:
        - code
        - state
    SlackUserData:
      type: object
      properties:
        slackId:
          type: string
          format: slack-id
          description: Slack user ID
          example: UGJ7AVX32
        name:
          type: string
          description: Slack user name
          example: Sam Kerr
        avatar:
          type: string
          format: uri
          description: Slack user avatar URL
          example: https://url.com/avatar.png
        locale:
          type: string
          format: LCID
          description: Slack user locale taken from their client preferences
          example: en
        forcedLocale:
          type: string
          format: LCID
          description: Slack user locale that they chose to use with the Freeday bot
          example: fr
        deleted:
          type: boolean
          description: If user has been deleted on Slack
          example: false
    SlackUser:
      allOf:
        - $ref: '#/components/schemas/DocumentId'
        - $ref: '#/components/schemas/SlackUserData'
    SlackUserList:
      allOf:
        - type: object
          properties:
            slackUsers:
              type: array
              items:
                $ref: '#/components/schemas/SlackUser'
        - $ref: '#/components/schemas/Total'
        - $ref: '#/components/schemas/Page'
    SlackUserCreate:
      allOf:
        - $ref: '#/components/schemas/SlackUserData'
        - required:
            - slackId
            - name
            - avatar
            - email
    SlackChannelData:
      type: object
      properties:
        slackId:
          type: string
          format: slack-id
          description: Slack channel ID
          example: C7J5HLC85
        name:
          type: string
          description: Slack channel name
          example: random-channel
        isChannel:
          type: boolean
          description: If channel is a public channel
          example: false
        isGroup:
          type: boolean
          description: If channel is a private channel
          example: false
        isIm:
          type: boolean
          description: If channel is a direct message between two members
          example: false
        isMpIm:
          type: boolean
          description: If channel is a direct message between more than two members
          example: false
        isMember:
          type: boolean
          description: If bot is a member of the conversation
          example: false
        isPrivate:
          type: boolean
          description: If channel is privileged between two or more members
          example: false
        archived:
          type: boolean
          description: If channel is archived
          example: false
    SlackChannel:
      allOf:
        - $ref: '#/components/schemas/DocumentId'
        - $ref: '#/components/schemas/SlackChannelData'
    SlackChannelList:
      allOf:
        - type: object
          properties:
            slackChannels:
              type: array
              items:
                $ref: '#/components/schemas/SlackChannel'
        - $ref: '#/components/schemas/Total'
        - $ref: '#/components/schemas/Page'
    SlackChannelCreate:
      allOf:
        - $ref: '#/components/schemas/SlackChannelData'
        - required:
            - slackId
            - name
    DayoffTypeData:
      type: object
      properties:
        name:
          type: string
          maxLength: 75,
          description: Dayoff type name
          example: Sick
        emoji:
          type: string
          nullable: true
          description: An emoji representing the dayoff type
          example: no_mouth
        enabled:
          type: boolean
          description: If daysoff can be created with this dayoff type
          example: true
          default: true
        displayed:
          type: boolean
          description: f the dayoff type is displayed in filters and forms
          example: true
          default: true
        important:
          type: boolean
          description: Daysoff with an important type will be highlighted on front clients
          example: false
          default: false
    DayoffType:
      allOf:
        - $ref: '#/components/schemas/DocumentId'
        - $ref: '#/components/schemas/DayoffTypeData'
    DayoffData:
      type: object
      properties:
        start:
          type: string
          format: date-time
          description: Start date
          example: '2018-12-23T23:00:00.000Z'
        end:
          type: string
          format: date-time
          description: End date
          example: '2018-12-25T23:00:00.000Z'
          default: Same as start date
        startPeriod:
          type: string
          description: Start date period
          example: am
          default: am
          enum:
            - am
            - pm
        endPeriod:
          type: string
          description: End date period
          example: pm
          default: pm
          enum:
            - am
            - pm
        count:
          type: integer
          description: Number of days in the dayoff
          example: 2
        days:
          type: array
          description: List of days in the dayoff
          items:
            type: string
            format: date-time
          example:
            - '2018-12-23T23:00:00.000Z'
            - '2018-12-24T23:00:00.000Z'
            - '2018-12-25T23:00:00.000Z'
        type:
          type: object
          allOf:
            - $ref: '#/components/schemas/DocumentId'
            - $ref: '#/components/schemas/DayoffType'
        slackUser:
          $ref: '#/components/schemas/SlackUser'
        comment:
          type: string
          description: Comment
          example: Some comment
        confirmed:
          type: boolean
          description: If dayoff is confirmed
          example: true
        canceled:
          type: boolean
          description: If dayoff is canceled
          example: false
    Dayoff:
      allOf:
        - $ref: '#/components/schemas/DocumentId'
        - $ref: '#/components/schemas/DayoffData'
    DayoffList:
      allOf:
        - type: object
          properties:
            daysoff:
              type: array
              items:
                $ref: '#/components/schemas/Dayoff'
        - $ref: '#/components/schemas/Total'
        - $ref: '#/components/schemas/Page'
    DayoffEdit:
      type: object
      properties:
        start:
          type: string
          format: date
          description: Start date
          example: '2018-12-23'
        end:
          type: string
          format: date
          description: End date
          example: '2018-12-25'
          default: Same as start date
        startPeriod:
          type: string
          description: Start date period
          example: am
          default: am
          enum:
            - am
            - pm
        endPeriod:
          type: string
          description: End date period
          example: pm
          default: pm
          enum:
            - am
            - pm
        type:
          description: Dayoff type ID
          type: string
          format: uuid
          example: 5edb896d286e1fba4f7047a1
        slackUser:
          description: Slack user ID
          type: string
          format: slack-id
          example: UGJ7AVX32
        comment:
          type: string
          description: Comment
          example: Some comment
        force:
          description: If true skips conflict detection
          type: boolean
          default: false
    DayoffCreate:
      allOf:
        - $ref: '#/components/schemas/DayoffEdit'
        - required:
            - type
            - slackUser
            - start
    DayoffConfirmPost:
      type: object
      properties:
        force:
          description: >
            * 'true' will force confirmation (any conflicted dayoff will be
            canceled)

            * 'false' will throw error if conflicts are detected
          type: boolean
          default: false
    DayoffCancelPost:
      type: object
      properties:
        cancelReason:
          description: Cancelation reason
          type: string
    DayoffTypeList:
      allOf:
        - type: object
          properties:
            dayoffTypes:
              type: array
              items:
                $ref: '#/components/schemas/DayoffType'
        - $ref: '#/components/schemas/Total'
        - $ref: '#/components/schemas/Page'
    DayoffTypeCreate:
      allOf:
        - $ref: '#/components/schemas/DayoffTypeData'
        - required:
            - name
    Configuration:
      type: object
      properties:
        brandingName:
          description: Branding name
          type: string
          example: Coddity
        brandingLogo:
          description: Branding logo in base64
          type: string
          format: base64
          example: data:image/png;base64,A0/b1C2//d3E4f==
        slackReferrer:
          description: Slack referrer user ID
          type: string
          format: slack-id
          example: UXJOA3X11
        workDays:
          type: array
          items:
            type: integer
            minimum: 0
            maximum: 6
          description: List of work days
          example:
            - 1
            - 2
            - 3
    ConfigurationPost:
      allOf:
        - $ref: '#/components/schemas/Configuration'
        - required:
            - workDays
    ConfigurationPublic:
      type: object
      properties:
        brandingName:
          description: Branding name
          type: string
          example: Coddity
        brandingLogo:
          description: Branding logo in base64
          type: string
          format: base64
          example: data:image/png;base64,A0/b1C2//d3E4f==
    JobData:
      type: object
      properties:
        name:
          type: string
          description: Identifies the job concerned bu these settings
        enabled: &ref_0
          type: boolean
          description: Defines if the job should be run
        dayOfMonth: &ref_1
          type: string
          description: >-
            The day of the month during which we want the job to run (supports
            the cron format)
          example: '*'
        hour: &ref_2
          type: string
          description: The hour of the day we want to run this job at
          example: '*'
        minute: &ref_3
          type: string
          description: The minute we want to run this job at
          example: '*'
    Job:
      allOf:
        - $ref: '#/components/schemas/DocumentId'
        - $ref: '#/components/schemas/JobData'
    enabled: *ref_0
    dayOfMonth: *ref_1
    hour: *ref_2
    minute: *ref_3
    JobEdit:
      type: object
      properties:
        enabled:
          $ref: '#/components/schemas/enabled'
        dayOfMonth:
          $ref: '#/components/schemas/dayOfMonth'
        hour:
          $ref: '#/components/schemas/hour'
        minute:
          $ref: '#/components/schemas/minute'
  responses:
    AuthenticationError:
      description: Authentication error
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/Error'
              - type: object
                example:
                  error: Authentication failed
                  code: 4010
    InternError:
      description: Intern error
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/Error'
              - type: object
                example:
                  error: Intern error
                  code: 5000
    ValidationError:
      description: Validation error (incorrect data sent)
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/Error'
              - type: object
                example:
                  error: Invalid data
                  code: 4000
                  data:
                    - name: field
                      in: body
                      error: Some reason
    ForbiddenError:
      description: Forbidden
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/Error'
              - type: object
                example:
                  error: Forbidden
                  code: 4030
    ConflictError:
      description: Conflict error
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/Error'
              - type: object
                example:
                  error: Conflicts detected
                  code: 4090
                  data:
                    - {}
    NotFoundError:
      description: Not found error
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/Error'
              - type: object
                example:
                  error: Not found
                  code: 4040
security:
  - BearerToken: []
