"use strict";(self.webpackChunkfreeday_doc=self.webpackChunkfreeday_doc||[]).push([[720],{8997:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return i},contentTitle:function(){return p},metadata:function(){return s},toc:function(){return d},default:function(){return k}});var o=t(7462),a=t(3366),r=(t(7294),t(3905)),l=["components"],i={},p="Deployment",s={unversionedId:"deployment",id:"deployment",isDocsHomePage:!1,title:"Deployment",description:"Docker",source:"@site/docs/deployment.md",sourceDirName:".",slug:"/deployment",permalink:"/docs/deployment",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Getting started",permalink:"/docs/getting-started"},next:{title:"Slack",permalink:"/docs/bot-slack"}},d=[{value:"Docker",id:"docker",children:[{value:"docker-compose.yml",id:"docker-composeyml",children:[],level:3},{value:".env",id:"env",children:[],level:3}],level:2},{value:"Local deployment",id:"local-deployment",children:[{value:"Running Ngrok",id:"running-ngrok",children:[],level:3},{value:"Configuring Slack app",id:"configuring-slack-app",children:[],level:3}],level:2}],c={toc:d};function k(e){var n=e.components,t=(0,a.Z)(e,l);return(0,r.kt)("wrapper",(0,o.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"deployment"},"Deployment"),(0,r.kt)("h2",{id:"docker"},"Docker"),(0,r.kt)("p",null,"Freeday can be easily deployed using Docker images."),(0,r.kt)("p",null,"You can find below an example of ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yaml")," file and its ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," companion."),(0,r.kt)("p",null,"Edit configuration as you wish then run the whole thing using ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose up -d"),"."),(0,r.kt)("h3",{id:"docker-composeyml"},"docker-compose.yml"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"version: '3'\n\nservices:\n  freeday-api:\n    image: freedayapp/freeday-api\n    container_name: freeday-api\n    restart: always\n    env_file:\n      - .env\n    networks:\n      - freeday-network\n    ports:\n      - 8787:8787\n  freeday-web:\n    image: freedayapp/freeday-web\n    container_name: freeday-web\n    restart: always\n    env_file:\n      - .env\n    networks:\n      - freeday-network\n    ports:\n      - 8788:8788\n  freeday-mongo:\n    image: mongo\n    container_name: freeday-mongo\n    restart: always\n    command: mongod --quiet --logpath /dev/null\n    networks:\n      - freeday-network\n\nnetworks:\n  freeday-network:\n    name: freeday\n")),(0,r.kt)("h3",{id:"env"},".env"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"##\n## General\n##\n\n# Freeday web front URL\n# E.g. https://web.domain.com/ or http://localhost:8788/\nFRONT_PUBLIC_URL=http://localhost:8788/\n\n# Freeday API URL\n# E.g. https://api.domain.com/ or http://localhost:8787/\nAPI_PUBLIC_URL=http://localhost:8787/\n\n# Port on which Freeday API will run\nAPI_PORT=8787\n\n# Path to logs directory\nAPI_LOG_DIR=/var/log/freeday\n\n##\n## Database\n##\n\n# Mongo database URL\nMONGO_URL=mongodb://freeday-mongo:27017/freeday\n\n# Mongo test database URL\n# This database is used when running tests\n# Not needed in production\n#MONGO_TEST_URL=mongodb://freeday-mongo:27017/freeday-test\n\n##\n## Slack bot\n##\n\n# If Slack bot should be enabled\nSLACK_ENABLED=true\n\n# Slack configuration\nSLACK_CLIENT_ID=1234567891234.1234567891234\nSLACK_CLIENT_SECRET=12345678912341234567891234\nSLACK_SIGNING_SECRET=abc123abc123abc123abc123abc123\nSLACK_ACCESS_TOKEN=xoxb-12345678-12345678-abc123abc123abc123abc123\n\n##\n## Dialogflow\n##\n\n# If Dialogflow NLU should be enabled\nDIALOGFLOW_ENABLED=false\n\n# Dialogflow configuration\nDIALOGFLOW_KEYFILE=/path/to/keyfile.json\nDIALOGFLOW_ENDPOINT=europe-west1-dialogflow.googleapis.com\nDIALOGFLOW_PROJECT=my-project\nDIALOGFLOW_LOCATION=europe-west1\nDIALOGFLOW_ENVIRONMENT=production\nDIALOGFLOW_USER=my-user\nDIALOGFLOW_SESSION=1234\nDIALOGFLOW_LANGUAGE=en\n")),(0,r.kt)("h2",{id:"local-deployment"},"Local deployment"),(0,r.kt)("p",null,"When deploying Freeday on a local environment, some additional steps are require so everything works properly."),(0,r.kt)("p",null,"In a local environment, the Freeday URL will be something like ",(0,r.kt)("inlineCode",{parentName:"p"},"http://localhost:8788/"),".\nThe problem is that Slack API can't reach your Freeday instance through this URL.\nTherefore you need to setup some kind of proxy / tunnel and set the correct URL in the Slack app manifest so it ca communicates with your Freeday instance."),(0,r.kt)("p",null,"Here we're gonna use ",(0,r.kt)("a",{parentName:"p",href:"https://ngrok.com/"},"Ngrok"),"."),(0,r.kt)("h3",{id:"running-ngrok"},"Running Ngrok"),(0,r.kt)("p",null,"Start a Ngrok tunnel targetting the API port (default is ",(0,r.kt)("inlineCode",{parentName:"p"},"8787"),")."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"ngrok http 8787\n")),(0,r.kt)("p",null,"Then get the tunnel ",(0,r.kt)("inlineCode",{parentName:"p"},"https")," URL in the Ngrok console. It should look like this: ",(0,r.kt)("inlineCode",{parentName:"p"},"https://1234-12-34-123-12.ngrok.io"),"."),(0,r.kt)("h3",{id:"configuring-slack-app"},"Configuring Slack app"),(0,r.kt)("p",null,"Go in to the ",(0,r.kt)("a",{parentName:"p",href:"https://api.slack.com/apps"},"Slack apps page")," and edit your Freeday app."),(0,r.kt)("p",null,"Put the Ngrok ",(0,r.kt)("inlineCode",{parentName:"p"},"https")," link in the ",(0,r.kt)("inlineCode",{parentName:"p"},"oauth_config"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"event_subscriptions")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"interactivity")," sections. In the ",(0,r.kt)("inlineCode",{parentName:"p"},"event_subscriptions")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"interactivity")," sections, be sure to keep the ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/slack/events")," path. Values should look like the example below."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# ...\noauth_config:\n  redirect_urls:\n    - https://1234-12-34-123-12.ngrok.io/\n# ...\nsettings:\n  event_subscriptions:\n    request_url: https://1234-12-34-123-12.ngrok.io/api/slack/events\n# ...\n  interactivity:\n    request_url: https://1234-12-34-123-12.ngrok.io/api/slack/events\n# ...\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Note: The ",(0,r.kt)("inlineCode",{parentName:"p"},"event_subscriptions")," URL must be validated in Slack app configuration.\nTo activate the URL, Freeday must be running and listening to Slack API calls.")))}k.isMDXComponent=!0}}]);